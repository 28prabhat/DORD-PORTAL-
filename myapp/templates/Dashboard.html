{% extends 'base.html' %}


{% block content %}

{% if user.is_authenticated and user.is_staff %}
<form action="{% url 'save_projects' %}" method="post">
    {% csrf_token %}
    <button type="submit" id="logoutButton" class="logout">Add Projects</button>
</form>

{% endif %}
<h2 style="text-align: center; font-weight: 600;">Project Dashboard</h2>
<div class="container">
    {% for project in projects %}
    <div class="card">
        <!-- <button class="bookmark-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
            </svg>
        </button> -->
        <button class="bookmark-btn" data-project-id="{{ project.id }}">
            {% if user.is_authenticated and project in user.userprofile.bookmarked_projects.all %}
                Unbookmark
            {% else %}
                Bookmark
            {% endif %}
        </button>
        <h2>{{ project.title }}</h2>
        <h4>{{ project.supervisor }}</h4>
        <div class="tags">
            <a href="#" class="tag">{{ project.tags }}</a>
            <!-- <h5 class="card-title">{{ project.title }}</h5>
                <h6 class="card-subtitle mb-2 text-muted">Supervisor: {{ project.supervisor }}</h6> -->
        </div>
        <p class="card-text"><strong>Country:</strong> {{ project.country }}</p>
        <p class="card-text"><strong>Open to:</strong> {{ project.open_to }}</p>
        <p class="card-text"><strong>Duration:</strong> {{ project.duration }}</p>
        <p class="card-text"><strong>Sponsor:</strong> {{ project.sponsor }}</p>
        <p class="card-text"><strong>Deadline:</strong> {{ project.deadline }}</p>
        <p class="card-text"><strong>Budget:</strong> {{ project.budget }}</p>
        <div class="buttons">
            <a href="#" class="btn">Details</a>
            <a href="{% url 'projectdetail' project_id=project.id %}" class="btn">Apply Now</a>

        </div>
    </div>
    {% endfor %}

    <div class="modal" id="filterModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Filter Options</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <span style="margin-right: 10px; font-weight: 600; font-size: 20px;">Title</span>
                    {% for project in projects %}
                    <!-- Add filter options -->
                    <label><input type="checkbox" class="filter-checkbox" data-filter="{{project.title}}"> {{project.title}}</label>
                    {% endfor %}
                </div>
                <div class="modal-body">
                    <span style="margin-right: 10px; font-weight: 600; font-size: 20px;">Supervisor</span>
                    {% for project in projects %}
                    <!-- Add filter options -->
                    <label><input type="checkbox" class="filter-checkbox" data-filter="{{project.supervisor}}"> {{project.supervisor}}</label>
                    {% endfor %}
                </div>
                <div class="modal-body">
                    <span style="margin-right: 10px; font-weight: 600; font-size: 20px;">Tags</span>
                    {% for project in projects %}
                    <!-- Add filter options -->
                    <label><input type="checkbox" class="filter-checkbox" data-filter="{{project.tags}}"> {{project.tags}}</label>
                    {% endfor %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="applyFiltersBtn">Apply Filters</button>
                </div>
            </div>
        </div>
    </div>
</div>


<script>

    // // Add functionality to bookmark buttons
    // document.querySelectorAll('.bookmark-btn').forEach(btn => {
    //     btn.addEventListener('click', function () {
    //         // Toggle fill of the bookmark icon
    //         const svg = this.querySelector('svg');
    //         svg.setAttribute('fill', svg.getAttribute('fill') === 'none' ? 'currentColor' : 'none');
    //         // Here you would also add logic to actually bookmark the project
    //     });
    // });

    // // Add functionality to show bookmarked cards and style the Bookmarked Projects tab

    // let isBookmarkedTabClicked = false;

    // document.querySelector('.item:nth-of-type(3)').addEventListener('click', function () {
    //     const cards = document.querySelectorAll('.card');

    //     if (isBookmarkedTabClicked) {
    //         // Show all cards
    //         cards.forEach(card => {
    //             card.style.display = 'block';
    //         });

    //         // Reset the Bookmarked Projects tab styling
    //         this.style.backgroundColor = '';
    //         isBookmarkedTabClicked = false;
    //     } else {
    //         // Show only bookmarked cards
    //         cards.forEach(card => {
    //             if (card.querySelector('.bookmark-btn svg').getAttribute('fill') === 'currentColor') {
    //                 card.style.display = 'block';
    //             } else {
    //                 card.style.display = 'none';
    //             }
    //         });

    //         // Style the Bookmarked Projects tab
    //         this.style.backgroundColor = '#0277bd';
    //         isBookmarkedTabClicked = true;
    //     }
    // });

    document.querySelectorAll('.bookmark-btn').forEach(button => {
        button.addEventListener('click', function() {
            const projectId = this.dataset.projectId;
            fetch(`/bookmark_project/${projectId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.action === 'added') {
                    this.textContent = 'Unbookmark';
                } else {
                    this.textContent = 'Bookmark';
                }
            });
        });
    });



    document.getElementById("filter").addEventListener("click", function () {
            $('#filterModal').modal('show');
        });

        document.getElementById("applyFiltersBtn").addEventListener("click", function () {
            const selectedFilters = [];

            // Gathering selected tag filters (assuming the tags are space-separated)
            document.querySelectorAll('.filter-checkbox:checked').forEach(function (checkbox) {
                selectedFilters.push(checkbox.getAttribute('data-filter'));
            });

            applyFilters(selectedFilters);
        });

        function applyFilters(selectedFilters) {
            const cards = document.querySelectorAll('.card');

            cards.forEach(card => {
                // Extract the project attributes from the card
                const title = card.querySelector('h2').textContent.toLowerCase();
                const supervisor = card.querySelector('h4').textContent.toLowerCase();
                const tags = Array.from(card.querySelectorAll('.tag')).map(tag => tag.textContent.toLowerCase());
                const country = card.querySelector('.card-text:nth-of-type(1)').textContent.toLowerCase();
                const openTo = card.querySelector('.card-text:nth-of-type(2)').textContent.toLowerCase();
                const duration = card.querySelector('.card-text:nth-of-type(3)').textContent.toLowerCase();
                const sponsor = card.querySelector('.card-text:nth-of-type(4)').textContent.toLowerCase();
                const deadline = card.querySelector('.card-text:nth-of-type(5)').textContent.toLowerCase();
                const budget = card.querySelector('.card-text:nth-of-type(6)').textContent.toLowerCase();

                // Perform filtering based on project attributes
                const shouldShowCard = selectedFilters.some(filter =>
                    title.includes(filter) ||
                    supervisor.includes(filter) ||
                    tags.some(tag => tag.includes(filter)) ||
                    country.includes(filter) ||
                    openTo.includes(filter) ||
                    duration.includes(filter) ||
                    sponsor.includes(filter) ||
                    deadline.includes(filter) ||
                    budget.includes(filter)
                );

                // Adjust card visibility based on filter result
                card.style.display = shouldShowCard ? 'block' : 'none';
            });
        }
</script>

{% endblock %}

</body>

</html>